# DupFinderï¼šä¸€ä¸ªç”¨ Rust ç¼–å†™çš„é«˜æ€§èƒ½é‡å¤æ–‡ä»¶æŸ¥æ‰¾å·¥å…·

## ğŸ“Œ å‰è¨€

åœ¨æ—¥å¸¸å·¥ä½œå’Œç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬çš„ç”µè„‘é‡Œç»å¸¸ä¼šç§¯ç´¯å¤§é‡é‡å¤æ–‡ä»¶â€”â€”ä¸‹è½½çš„é‡å¤ç…§ç‰‡ã€å¤‡ä»½çš„æ–‡æ¡£å‰¯æœ¬ã€å¤šæ¬¡ä¿å­˜çš„è§†é¢‘æ–‡ä»¶ç­‰ã€‚è¿™äº›é‡å¤æ–‡ä»¶ä¸ä»…å ç”¨å®è´µçš„ç£ç›˜ç©ºé—´ï¼Œè¿˜è®©æ–‡ä»¶ç®¡ç†å˜å¾—æ··ä¹±ã€‚

ä»Šå¤©ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªæˆ‘ç”¨ Rust ç¼–å†™çš„é‡å¤æ–‡ä»¶æŸ¥æ‰¾å·¥å…· **DupFinder**ï¼Œå®ƒä¸ä»…é€Ÿåº¦å¿«ã€å‡†ç¡®ç‡é«˜ï¼Œè¿˜æ”¯æŒ **JSON å¯¼å‡º**å’Œ**å®‰å…¨åˆ é™¤è„šæœ¬ç”Ÿæˆ**ï¼Œéå¸¸é€‚åˆéœ€è¦è‡ªåŠ¨åŒ–å¤„ç†æˆ–æ‰¹é‡æ¸…ç†é‡å¤æ–‡ä»¶çš„åœºæ™¯ã€‚

> **é¡¹ç›®åœ°å€**ï¼š
> - GitHub: https://github.com/Waitfish/dupfinder
> - crates.io: https://crates.io/crates/dupfinder

---

## ğŸ¯ é¡¹ç›®èƒŒæ™¯

### ä¸ºä»€ä¹ˆè¦å†™è¿™ä¸ªå·¥å…·ï¼Ÿ

å¸‚é¢ä¸Šå·²ç»æœ‰ä¸€äº›é‡å¤æ–‡ä»¶æŸ¥æ‰¾å·¥å…·ï¼Œæ¯”å¦‚ï¼š
- **fdupes** (C è¯­è¨€)ï¼šç»å…¸å·¥å…·ï¼Œä½†ç¼ºå°‘ç°ä»£åŒ–çš„åŠŸèƒ½ï¼ˆæ—  JSON è¾“å‡ºã€æ— å½©è‰²ç•Œé¢ï¼‰
- **rdfind** (C++)ï¼šé€Ÿåº¦å¿«ä½†å‡†ç¡®æ€§ç¨ä½ï¼Œä¸”åªæ”¯æŒ Linux

æˆ‘å¸Œæœ›å¼€å‘ä¸€ä¸ªï¼š
1. **å‡†ç¡®æ€§ 100%** çš„å·¥å…·ï¼ˆ4 å±‚éªŒè¯ï¼‰
2. æ”¯æŒ **JSON è¾“å‡º**ï¼Œæ–¹ä¾¿è‡ªåŠ¨åŒ–å’Œ CI/CD é›†æˆ
3. ç”Ÿæˆ**å®‰å…¨çš„åˆ é™¤è„šæœ¬**ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ é™¤
4. æœ‰**å‹å¥½çš„å½©è‰²ç•Œé¢**
5. **è·¨å¹³å°æ”¯æŒ**ï¼ˆLinuxã€macOSã€Windowsï¼‰

äºæ˜¯ **DupFinder** è¯ç”Ÿäº†ï¼

### æŠ€æœ¯é€‰å‹ï¼šä¸ºä»€ä¹ˆé€‰æ‹© Rustï¼Ÿ

- âš¡ **æ€§èƒ½ä¼˜å¼‚**ï¼šæ¥è¿‘ C/C++ çš„æ€§èƒ½
- ğŸ”’ **å†…å­˜å®‰å…¨**ï¼šæ—  GCï¼Œæ— å†…å­˜æ³„æ¼ï¼Œæ— æ•°æ®ç«äº‰
- ğŸ“¦ **æ˜“äºåˆ†å‘**ï¼šé™æ€é“¾æ¥ï¼Œå•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶
- ğŸ› ï¸ **ä¼˜ç§€çš„å·¥å…·é“¾**ï¼šCargo åŒ…ç®¡ç†ï¼Œå¼ºå¤§çš„ç±»å‹ç³»ç»Ÿ

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. å››å±‚éªŒè¯æœºåˆ¶ï¼ˆ100% å‡†ç¡®ï¼‰

DupFinder é‡‡ç”¨æ¸è¿›å¼çš„ 4 å±‚éªŒè¯ç­–ç•¥ï¼Œç¡®ä¿æŸ¥æ‰¾ç»“æœ 100% å‡†ç¡®ï¼š

```
ç¬¬ 1 å±‚ï¼šæ–‡ä»¶å¤§å°æ¯”è¾ƒ
    â†“ (å¿«é€Ÿæ’é™¤å¤§å°ä¸åŒçš„æ–‡ä»¶)
ç¬¬ 2 å±‚ï¼šéƒ¨åˆ†å†…å®¹å“ˆå¸Œ (å‰ 8KB çš„ MD5)
    â†“ (æ’é™¤å¼€å¤´ä¸åŒçš„æ–‡ä»¶)
ç¬¬ 3 å±‚ï¼šå®Œæ•´æ–‡ä»¶ MD5
    â†“ (æ’é™¤å†…å®¹ä¸åŒçš„æ–‡ä»¶)
ç¬¬ 4 å±‚ï¼šé€å­—èŠ‚æ¯”è¾ƒ
    â†“ (æœ€ç»ˆç¡®è®¤ 100% ç›¸åŒ)
âœ… ç¡®è®¤ä¸ºé‡å¤æ–‡ä»¶
```

**ä¸ºä»€ä¹ˆéœ€è¦ 4 å±‚éªŒè¯ï¼Ÿ**
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§éƒ¨åˆ†æ–‡ä»¶åœ¨å‰ 1-2 å±‚å°±è¢«æ’é™¤ï¼Œé¿å…ä¸å¿…è¦çš„ MD5 è®¡ç®—
- **é¿å…å“ˆå¸Œç¢°æ’**ï¼šè™½ç„¶ MD5 ç¢°æ’æ¦‚ç‡æä½ï¼Œä½†é€å­—èŠ‚æ¯”è¾ƒç¡®ä¿ 100% å‡†ç¡®
- **å¤„ç†ç¡¬é“¾æ¥**ï¼šæ£€æµ‹åŒä¸€ inode çš„æ–‡ä»¶ï¼Œé¿å…è¯¯æŠ¥

### 2. JSON è¾“å‡ºï¼ˆç‹¬å®¶åŠŸèƒ½ï¼‰

ä¸ fdupes å’Œ rdfind ä¸åŒï¼ŒDupFinder æ”¯æŒå¯¼å‡ºç»“æ„åŒ–çš„ JSON æŠ¥å‘Šï¼š

```bash
dupfinder ~/Downloads --json report.json
```

**JSON æ ¼å¼ç¤ºä¾‹**ï¼š

```json
{
  "scan_info": {
    "base_path": "/home/user/Downloads",
    "total_groups": 2,
    "timestamp": "2025-12-02T16:30:00+08:00"
  },
  "duplicate_groups": [
    {
      "group_id": 1,
      "file_size": 1048576,
      "file_count": 3,
      "md5_hash": "5d41402abc4b2a76b9719d911017c592",
      "files": [
        {
          "path": "/home/user/Downloads/file1.txt",
          "absolute_path": "/home/user/Downloads/file1.txt"
        }
      ]
    }
  ],
  "statistics": {
    "total_duplicate_files": 5,
    "deletable_files": 3,
    "potential_space_savings": 3145728
  }
}
```

**åº”ç”¨åœºæ™¯**ï¼š
- âœ… CI/CD é›†æˆï¼šè‡ªåŠ¨æ£€æµ‹ä»£ç ä»“åº“ä¸­çš„é‡å¤æ–‡ä»¶
- âœ… è‡ªåŠ¨åŒ–è„šæœ¬ï¼šç”¨ Python/Node.js è§£æ JSON è¿›è¡Œæ‰¹å¤„ç†
- âœ… æ•°æ®åˆ†æï¼šç»Ÿè®¡é‡å¤æ–‡ä»¶çš„åˆ†å¸ƒæƒ…å†µ

### 3. å®‰å…¨åˆ é™¤è„šæœ¬ç”Ÿæˆï¼ˆç‹¬å®¶åŠŸèƒ½ï¼‰

DupFinder ä¸ä¼šç›´æ¥åˆ é™¤æ–‡ä»¶ï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªå¯ç¼–è¾‘çš„ Bash åˆ é™¤è„šæœ¬ï¼š

```bash
dupfinder ~/Downloads --delete-script delete.sh
```

**è„šæœ¬ç‰¹ç‚¹**ï¼š
- âœ… éœ€è¦æ‰‹åŠ¨è¾“å…¥ `yes` ç¡®è®¤ï¼Œé˜²æ­¢è¯¯åˆ 
- âœ… è¯¦ç»†çš„æ³¨é‡Šï¼Œæ¸…æ¥šæ ‡æ³¨ä¿ç•™å’Œåˆ é™¤çš„æ–‡ä»¶
- âœ… å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘è„šæœ¬ï¼Œé€‰æ‹©ä¿ç•™å“ªä¸ªæ–‡ä»¶
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç»Ÿè®¡ä¿¡æ¯

**ç”Ÿæˆçš„è„šæœ¬ç¤ºä¾‹**ï¼š

```bash
#!/bin/bash
# ä¿ç•™: /home/user/Downloads/photo.jpg
# åˆ é™¤æ–‡ä»¶ 1/2
if [ -f "/home/user/Downloads/photo_copy.jpg" ]; then
    echo "åˆ é™¤: /home/user/Downloads/photo_copy.jpg"
    rm "/home/user/Downloads/photo_copy.jpg"
fi
```

### 4. å…¶ä»–å®ç”¨åŠŸèƒ½

- ğŸ¨ **å½©è‰²è¾“å‡º**ï¼šæ¸…æ™°æ˜“è¯»çš„ç»ˆç«¯ç•Œé¢
- ğŸ“Š **è¯¦ç»†æ¨¡å¼**ï¼šæ˜¾ç¤º 4 å±‚éªŒè¯çš„å®Œæ•´è¿‡ç¨‹
- ğŸ’¾ **ç©ºé—´ç»Ÿè®¡**ï¼šæ˜¾ç¤ºå¯èŠ‚çœçš„ç£ç›˜ç©ºé—´
- ğŸ”— **ç¡¬é“¾æ¥æ£€æµ‹**ï¼šæ™ºèƒ½è¯†åˆ«å¹¶è·³è¿‡ç¡¬é“¾æ¥ï¼ˆå¯é€‰ï¼‰
- ğŸ“ **è·¯å¾„æ˜¾ç¤º**ï¼šæ”¯æŒç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„
- ğŸ”„ **é€’å½’æ‰«æ**ï¼šé»˜è®¤æ‰«ææ‰€æœ‰å­ç›®å½•

---

## ğŸ“¦ å®‰è£…æ–¹æ³•

### æ–¹å¼ 1ï¼šä» crates.io å®‰è£…ï¼ˆæ¨èï¼‰

å¦‚æœä½ å·²ç»å®‰è£…äº† Rustï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Cargo å®‰è£…ï¼š

```bash
cargo install dupfinder
```

**ä¼˜ç‚¹**ï¼š
- è‡ªåŠ¨ç¼–è¯‘ä¼˜åŒ–ç‰ˆæœ¬
- è‡ªåŠ¨å®‰è£…åˆ° `~/.cargo/bin`
- å®¹æ˜“æ›´æ–°ï¼š`cargo install dupfinder --force`

### æ–¹å¼ 2ï¼šä» GitHub Release ä¸‹è½½

è®¿é—® [Releases é¡µé¢](https://github.com/Waitfish/dupfinder/releases)ï¼Œä¸‹è½½é€‚åˆä½ ç³»ç»Ÿçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼š

- `dupfinder-linux-x86_64` - Linux (GNU)
- `dupfinder-linux-x86_64-musl` - Linux (é™æ€é“¾æ¥)
- `dupfinder-macos-x86_64` - macOS (Intel)
- `dupfinder-macos-aarch64` - macOS (Apple Silicon)
- `dupfinder-windows-x86_64.exe` - Windows

**Linux/macOS å®‰è£…**ï¼š

```bash
# ä¸‹è½½åèµ‹äºˆæ‰§è¡Œæƒé™
chmod +x dupfinder-linux-x86_64

# ç§»åŠ¨åˆ° PATH ç›®å½•
sudo mv dupfinder-linux-x86_64 /usr/local/bin/dupfinder
```

### æ–¹å¼ 3ï¼šä»æºç ç¼–è¯‘

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/Waitfish/dupfinder.git
cd dupfinder

# ç¼–è¯‘ï¼ˆRelease æ¨¡å¼ï¼‰
cargo build --release

# å®‰è£…
sudo cp target/release/dupfinder /usr/local/bin/
```

**éªŒè¯å®‰è£…**ï¼š

```bash
dupfinder --version
dupfinder --help
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

#### 1. æ‰«æå½“å‰ç›®å½•

```bash
# é€’å½’æ‰«æå½“å‰ç›®å½•åŠæ‰€æœ‰å­ç›®å½•ï¼ˆé»˜è®¤ï¼‰
dupfinder

# æˆ–æŒ‡å®šç›®å½•
dupfinder ~/Downloads
```

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
ğŸ” DupFinder - é‡å¤æ–‡ä»¶æŸ¥æ‰¾å·¥å…·
ğŸ“‚ æ‰«æè·¯å¾„: /home/user/Downloads
ğŸ”„ é€’å½’æ¨¡å¼: å¼€å¯

ğŸ” å¼€å§‹æ‰«æ 1234 ä¸ªæ–‡ä»¶...

======================================================================
ğŸ“Š å‘ç° 3 ç»„é‡å¤æ–‡ä»¶
======================================================================

ç»„ 1:
  /home/user/Downloads/photo1.jpg
  /home/user/Downloads/backup/photo1.jpg

ç»„ 2:
  /home/user/Downloads/video.mp4
  /home/user/Downloads/copy_video.mp4
  /home/user/Downloads/video_backup.mp4

======================================================================
ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯:
  æ€»é‡å¤æ–‡ä»¶æ•°: 5
  å¯åˆ é™¤æ–‡ä»¶æ•°: 3 (ä¿ç•™æ¯ç»„ 1 ä¸ª)
======================================================================
```

#### 2. æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯

```bash
dupfinder -v -S ~/Downloads
```

**å‚æ•°è¯´æ˜**ï¼š
- `-v` æˆ– `--verbose`ï¼šæ˜¾ç¤º 4 å±‚éªŒè¯çš„è¯¦ç»†è¿‡ç¨‹
- `-S` æˆ– `--size`ï¼šæ˜¾ç¤ºæ–‡ä»¶å¤§å°å’Œå¯èŠ‚çœç©ºé—´

**è¾“å‡ºç¤ºä¾‹**ï¼š

```
ğŸ” ç¬¬ 1 å±‚ï¼šæŒ‰æ–‡ä»¶å¤§å°åˆ†ç»„...
  âœ“ æ‰¾åˆ° 15 ç»„å¯èƒ½é‡å¤çš„æ–‡ä»¶ï¼ˆ50 ä¸ªæ–‡ä»¶ï¼‰
ğŸ” ç¬¬ 2 å±‚ï¼šè®¡ç®—éƒ¨åˆ†å†…å®¹å“ˆå¸Œ...
  âœ“ æ£€æŸ¥äº† 50 ä¸ªæ–‡ä»¶ï¼Œæ‰¾åˆ° 8 ç»„éƒ¨åˆ†å“ˆå¸Œç›¸åŒï¼ˆ20 ä¸ªæ–‡ä»¶ï¼‰
ğŸ” ç¬¬ 3 å±‚ï¼šè®¡ç®—å®Œæ•´æ–‡ä»¶ MD5...
  âœ“ æ£€æŸ¥äº† 20 ä¸ªæ–‡ä»¶ï¼Œæ‰¾åˆ° 5 ç»„å®Œæ•´ MD5 ç›¸åŒï¼ˆ15 ä¸ªæ–‡ä»¶ï¼‰
ğŸ” ç¬¬ 4 å±‚ï¼šé€å­—èŠ‚æ¯”è¾ƒéªŒè¯...
  â†ª è·³è¿‡ç¡¬é“¾æ¥: file1 <-> file1_link
  âœ“ è¿›è¡Œäº† 10 æ¬¡å­—èŠ‚æ¯”è¾ƒï¼Œç¡®è®¤ 5 ç»„å®Œå…¨é‡å¤ï¼ˆ15 ä¸ªæ–‡ä»¶ï¼‰

ç»„ 1:
  æ–‡ä»¶å¤§å°: 1.5 MB
  /home/user/Downloads/photo1.jpg
  /home/user/Downloads/photo2.jpg

å¯èŠ‚çœç©ºé—´: 10.5 MB (10485760 bytes)
```

#### 3. åªæ‰«æå½“å‰ç›®å½•ï¼ˆä¸é€’å½’ï¼‰

```bash
dupfinder -n ~/Downloads
```

å‚æ•° `-n` æˆ– `--no-recursive` è¡¨ç¤ºä¸é€’å½’æ‰«æå­ç›®å½•ã€‚

#### 4. ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ˜¾ç¤º

```bash
dupfinder -R ~/project
```

å‚æ•° `-R` æˆ– `--relative` æ˜¾ç¤ºç›¸å¯¹è·¯å¾„ï¼Œæ–¹ä¾¿æŸ¥çœ‹é¡¹ç›®ç»“æ„ã€‚

### é«˜çº§åŠŸèƒ½

#### 1. å¯¼å‡º JSON æŠ¥å‘Š

```bash
dupfinder ~/Downloads --json report.json
```

**ä½¿ç”¨ jq è§£æ JSON**ï¼š

```bash
# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
cat report.json | jq '.statistics'

# æŸ¥çœ‹å¯èŠ‚çœç©ºé—´
cat report.json | jq '.statistics.potential_space_savings'

# æŸ¥çœ‹æ‰€æœ‰é‡å¤ç»„
cat report.json | jq '.duplicate_groups[]'
```

**Python å¤„ç†ç¤ºä¾‹**ï¼š

```python
import json

with open('report.json') as f:
    data = json.load(f)

print(f"æ‰«æè·¯å¾„: {data['scan_info']['base_path']}")
print(f"é‡å¤ç»„æ•°: {data['scan_info']['total_groups']}")
print(f"å¯èŠ‚çœç©ºé—´: {data['statistics']['potential_space_savings'] / 1024 / 1024:.2f} MB")

for group in data['duplicate_groups']:
    print(f"\nç»„ {group['group_id']}:")
    for file in group['files']:
        print(f"  - {file['path']}")
```

#### 2. ç”Ÿæˆåˆ é™¤è„šæœ¬

```bash
# ç”Ÿæˆåˆ é™¤è„šæœ¬
dupfinder ~/Downloads --delete-script delete_dups.sh

# æŸ¥çœ‹è„šæœ¬å†…å®¹
cat delete_dups.sh

# æ‰§è¡Œåˆ é™¤ï¼ˆéœ€è¦ç¡®è®¤ï¼‰
bash delete_dups.sh
```

**æ‰§è¡Œæ•ˆæœ**ï¼š

```
âš ï¸  è­¦å‘Š: å³å°†åˆ é™¤é‡å¤æ–‡ä»¶ï¼
æ‰«æè·¯å¾„: /home/user/Downloads
é‡å¤ç»„æ•°: 3
å°†åˆ é™¤æ–‡ä»¶æ•°: 5
å¯èŠ‚çœç©ºé—´: 10.5 MB

ç¡®è®¤è¦ç»§ç»­å—? (yes/no): yes
åˆ é™¤: /home/user/Downloads/photo_copy.jpg
åˆ é™¤: /home/user/Downloads/video_backup.mp4
...
âœ… æˆåŠŸåˆ é™¤: 5 ä¸ªæ–‡ä»¶
ğŸ’¾ èŠ‚çœç©ºé—´: 10.50MB
```

#### 3. åŒæ—¶ç”Ÿæˆ JSON å’Œåˆ é™¤è„šæœ¬

```bash
dupfinder -v -S ~/Downloads \
    --json report.json \
    --delete-script delete_dups.sh
```

è¿™æ ·å¯ä»¥å…ˆæŸ¥çœ‹ JSON æŠ¥å‘Šï¼Œå†å†³å®šæ˜¯å¦æ‰§è¡Œåˆ é™¤ã€‚

### å®Œæ•´å‚æ•°åˆ—è¡¨

| å‚æ•° | ç®€å†™ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| `<path>` | - | æ‰«æç›®å½• | `.` (å½“å‰ç›®å½•) |
| `--recursive` | `-r` | é€’å½’æ‰«æ | å¼€å¯ |
| `--no-recursive` | `-n` | ä¸é€’å½’ | - |
| `--verbose` | `-v` | è¯¦ç»†æ¨¡å¼ | å…³é—­ |
| `--size` | `-S` | æ˜¾ç¤ºå¤§å° | å…³é—­ |
| `--relative` | `-R` | ç›¸å¯¹è·¯å¾„ | å…³é—­ |
| `--hardlinks` | `-H` | åŒ…å«ç¡¬é“¾æ¥ | å…³é—­ |
| `--json <FILE>` | - | JSON è¾“å‡º | - |
| `--delete-script <FILE>` | - | ç”Ÿæˆåˆ é™¤è„šæœ¬ | - |

---

## ğŸ¯ å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šæ¸…ç†ä¸‹è½½æ–‡ä»¶å¤¹

```bash
# æŸ¥çœ‹å¯ä»¥åˆ é™¤å¤šå°‘é‡å¤æ–‡ä»¶
dupfinder -S ~/Downloads

# ç”Ÿæˆåˆ é™¤è„šæœ¬
dupfinder ~/Downloads --delete-script clean_downloads.sh

# æ£€æŸ¥å¹¶æ‰§è¡Œ
bash clean_downloads.sh
```

### åœºæ™¯ 2ï¼šä»£ç ä»“åº“å»é‡

```bash
cd ~/my-project

# ä½¿ç”¨ç›¸å¯¹è·¯å¾„æŸ¥çœ‹
dupfinder -R .

# å¯¼å‡ºæŠ¥å‘Š
dupfinder . --json dup_report.json
```

### åœºæ™¯ 3ï¼šå¤‡ä»½æ–‡ä»¶æ£€æŸ¥

```bash
# è¯¦ç»†æ¨¡å¼æŸ¥çœ‹éªŒè¯è¿‡ç¨‹
dupfinder -v ~/backup

# åŒæ—¶ç”ŸæˆæŠ¥å‘Šå’Œåˆ é™¤è„šæœ¬
dupfinder ~/backup --json backup_report.json --delete-script clean_backup.sh
```

### åœºæ™¯ 4ï¼šCI/CD é›†æˆ

```bash
#!/bin/bash
# åœ¨ CI ä¸­æ£€æŸ¥é‡å¤æ–‡ä»¶

dupfinder . --json dup_report.json

# è§£æ JSON
deletable=$(jq '.statistics.deletable_files' dup_report.json)

if [ "$deletable" -gt 0 ]; then
    echo "âš ï¸  å‘ç° $deletable ä¸ªé‡å¤æ–‡ä»¶ï¼Œè¯·æ¸…ç†"
    jq '.duplicate_groups[]' dup_report.json
    exit 1
fi

echo "âœ… æœªå‘ç°é‡å¤æ–‡ä»¶"
```

### åœºæ™¯ 5ï¼šå®šæœŸæ¸…ç†ä»»åŠ¡

```bash
# åˆ›å»ºæ¸…ç†è„šæœ¬ weekly_cleanup.sh
#!/bin/bash
dupfinder ~/Downloads --delete-script /tmp/cleanup.sh --json /tmp/report.json

# å‘é€æŠ¥å‘Šé‚®ä»¶
mail -s "é‡å¤æ–‡ä»¶æ¸…ç†æŠ¥å‘Š" user@example.com < /tmp/report.json

# å¯é€‰ï¼šè‡ªåŠ¨æ‰§è¡Œï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰
# echo "yes" | bash /tmp/cleanup.sh

# æ·»åŠ åˆ° crontabï¼ˆæ¯å‘¨æ—¥å‡Œæ™¨ 2 ç‚¹ï¼‰
# 0 2 * * 0 /home/user/weekly_cleanup.sh
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### é¡¹ç›®ç»“æ„

```
dupfinder/
â”œâ”€â”€ Cargo.toml          # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main.rs         # ä¸»ç¨‹åºï¼ˆ803 è¡Œï¼‰
â”œâ”€â”€ README.md           # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ USAGE.md            # è¯¦ç»†ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ CHEATSHEET.md       # å¿«é€Ÿå‚è€ƒ
â””â”€â”€ .github/workflows/  # CI/CD é…ç½®
```

### æ ¸å¿ƒä¾èµ–

```toml
[dependencies]
clap = { version = "4.4", features = ["derive"] }  # å‘½ä»¤è¡Œå‚æ•°è§£æ
walkdir = "2.4"           # ç›®å½•éå†
md5 = "0.7"               # MD5 å“ˆå¸Œè®¡ç®—
colored = "2.1"           # å½©è‰²è¾“å‡º
same-file = "1.0"         # ç¡¬é“¾æ¥æ£€æµ‹
serde = { version = "1.0", features = ["derive"] }  # JSON åºåˆ—åŒ–
serde_json = "1.0"        # JSON æ”¯æŒ
chrono = "0.4"            # æ—¶é—´å¤„ç†
```

### å…³é”®æ•°æ®ç»“æ„

```rust
#[derive(Debug, Clone, Serialize, Deserialize)]
struct FileInfo {
    path: PathBuf,              // æ–‡ä»¶è·¯å¾„
    size: u64,                  // æ–‡ä»¶å¤§å°
    partial_hash: Option<String>,  // éƒ¨åˆ†å“ˆå¸Œï¼ˆ8KBï¼‰
    full_hash: Option<String>,     // å®Œæ•´ MD5
}

struct DupFinder {
    verbose: bool,              // è¯¦ç»†æ¨¡å¼
    show_size: bool,            // æ˜¾ç¤ºå¤§å°
    include_hardlinks: bool,    // åŒ…å«ç¡¬é“¾æ¥
    relative_path: bool,        // ç›¸å¯¹è·¯å¾„
    base_path: PathBuf,         // åŸºå‡†è·¯å¾„
}
```

### æ€§èƒ½ä¼˜åŒ–

1. **åˆ†å±‚ç­›é€‰**ï¼šå¤§éƒ¨åˆ†æ–‡ä»¶åœ¨å‰ 1-2 å±‚å°±è¢«æ’é™¤
2. **æŒ‰éœ€è®¡ç®—**ï¼šåªå¯¹æ½œåœ¨é‡å¤æ–‡ä»¶è®¡ç®—å“ˆå¸Œ
3. **ç¼“å†²è¯»å–**ï¼šä½¿ç”¨ 8KB ç¼“å†²åŒºå‡å°‘ I/O
4. **ç¼–è¯‘ä¼˜åŒ–**ï¼šä½¿ç”¨ `opt-level = "z"` å’Œ `lto = true`

**Cargo.toml ä¼˜åŒ–é…ç½®**ï¼š

```toml
[profile.release]
strip = true       # å»æ‰ç¬¦å·è¡¨
opt-level = "z"    # ä¼˜åŒ–ä½“ç§¯
lto = true         # é“¾æ¥æ—¶ä¼˜åŒ–
codegen-units = 1  # å¢åŠ ä¼˜åŒ–æœºä¼š
```

æœ€ç»ˆäºŒè¿›åˆ¶å¤§å°ï¼š**758KB**ï¼ˆä¼˜åŒ–åï¼‰

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

æµ‹è¯•ç¯å¢ƒï¼š1000 ä¸ªæ–‡ä»¶ï¼Œæ€»å¤§å° 500MB

| å·¥å…· | æ—¶é—´ | å‡†ç¡®æ€§ | åŠŸèƒ½ |
|------|------|--------|------|
| **dupfinder** | 2.3s | 100% | JSONã€åˆ é™¤è„šæœ¬ã€å½©è‰²è¾“å‡º |
| fdupes | 2.5s | 100% | äº¤äº’å¼åˆ é™¤ |
| rdfind | 1.8s | 99.9% | è‡ªåŠ¨åˆ é™¤ |
| çº¯ MD5 | 3.2s | 99.9% | - |

---

## ğŸ†š ä¸å…¶ä»–å·¥å…·å¯¹æ¯”

| ç‰¹æ€§ | dupfinder | fdupes | rdfind |
|------|-----------|--------|--------|
| è¯­è¨€ | Rust ğŸ¦€ | C | C++ |
| 4 å±‚éªŒè¯ | âœ… | âœ… | âŒ |
| **JSON è¾“å‡º** | âœ… | âŒ | âŒ |
| **åˆ é™¤è„šæœ¬** | âœ… | âŒ | âœ… (è‡ªåŠ¨) |
| å½©è‰²è¾“å‡º | âœ… | âŒ | âŒ |
| ç¡¬é“¾æ¥æ£€æµ‹ | âœ… | âœ… | âœ… |
| è·¨å¹³å° | âœ… | âœ… | Linux |
| äºŒè¿›åˆ¶å¤§å° | 758KB | ~50KB | ~100KB |

**DupFinder çš„ä¼˜åŠ¿**ï¼š
- âœ… å”¯ä¸€æ”¯æŒ JSON è¾“å‡ºçš„å·¥å…·
- âœ… ç”Ÿæˆå®‰å…¨çš„åˆ é™¤è„šæœ¬ï¼ˆå¯ç¼–è¾‘ã€éœ€ç¡®è®¤ï¼‰
- âœ… ç°ä»£åŒ–çš„å½©è‰²ç•Œé¢
- âœ… å®Œæ•´çš„æ–‡æ¡£å’Œç¤ºä¾‹

---

## ğŸ’¡ Rust å­¦ä¹ å¿ƒå¾—

ä½œä¸ºä¸€ä¸ª Rust å­¦ä¹ é¡¹ç›®ï¼ŒDupFinder è®©æˆ‘æ·±å…¥ç†è§£äº†ï¼š

### 1. æ‰€æœ‰æƒå’Œå€Ÿç”¨

```rust
// å€Ÿç”¨è·¯å¾„ï¼Œä¸è·å–æ‰€æœ‰æƒ
fn calculate_md5(&self, path: &Path) -> io::Result<String> {
    let mut file = File::open(path)?;  // path æ˜¯å€Ÿç”¨çš„
    // ...
}
```

### 2. é”™è¯¯å¤„ç†

```rust
// Result<T, E> å¼ºåˆ¶å¤„ç†é”™è¯¯
fn find_duplicates(&self, root: &Path) -> Vec<Vec<FileInfo>> {
    match fs::metadata(path) {
        Ok(metadata) => { /* å¤„ç† */ },
        Err(e) => { /* é”™è¯¯å¤„ç† */ }
    }
}
```

### 3. è¿­ä»£å™¨å’Œå‡½æ•°å¼ç¼–ç¨‹

```rust
// filter_map, map ç­‰é›¶æˆæœ¬æŠ½è±¡
let paths: Vec<_> = WalkDir::new(root)
    .into_iter()
    .filter_map(|e| e.ok())
    .filter(|e| e.file_type().is_file())
    .map(|e| e.path().to_path_buf())
    .collect();
```

### 4. åºåˆ—åŒ–

```rust
// ä½¿ç”¨ serde è‡ªåŠ¨åºåˆ—åŒ–
#[derive(Serialize, Deserialize)]
struct FileInfo {
    path: PathBuf,
    size: u64,
}

let json = serde_json::to_string_pretty(&report)?;
```

---

## ğŸ“ æ€»ç»“

DupFinder æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ€§èƒ½ä¼˜å¼‚çš„é‡å¤æ–‡ä»¶æŸ¥æ‰¾å·¥å…·ï¼Œç‰¹åˆ«é€‚åˆï¼š

âœ… éœ€è¦è‡ªåŠ¨åŒ–å¤„ç†çš„åœºæ™¯ï¼ˆJSON è¾“å‡ºï¼‰  
âœ… éœ€è¦å®‰å…¨å®¡æŸ¥çš„åœºæ™¯ï¼ˆåˆ é™¤è„šæœ¬ï¼‰  
âœ… éœ€è¦è·¨å¹³å°æ”¯æŒçš„åœºæ™¯  
âœ… è¿½æ±‚å‡†ç¡®æ€§çš„åœºæ™¯ï¼ˆ4 å±‚éªŒè¯ï¼‰

### ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] äº¤äº’å¼åˆ é™¤æ¨¡å¼
- [ ] å¹¶è¡Œå¤„ç†å¤§æ–‡ä»¶
- [ ] è¿›åº¦æ¡æ˜¾ç¤º
- [ ] æ›´å¤šå“ˆå¸Œç®—æ³•ï¼ˆSHA256, xxHashï¼‰
- [ ] CSV è¾“å‡ºæ ¼å¼

### é¡¹ç›®é“¾æ¥

- **GitHub**: https://github.com/Waitfish/dupfinder
- **crates.io**: https://crates.io/crates/dupfinder
- **å®‰è£…**: `cargo install dupfinder`

æ¬¢è¿å¤§å®¶è¯•ç”¨å¹¶æå‡ºå»ºè®®ï¼å¦‚æœè§‰å¾—æœ‰ç”¨ï¼Œè¯·ç»™ä¸ª â­ Starï¼

---

## ğŸ™ å‚è€ƒèµ„æ–™

- [Rust å®˜æ–¹æ–‡æ¡£](https://doc.rust-lang.org/)
- [Cargo Book](https://doc.rust-lang.org/cargo/)
- [fdupes](https://github.com/adrianlopezroche/fdupes)
- [rdfind](https://github.com/pauldreik/rdfind)

---

**å…³æ³¨æˆ‘ï¼Œäº†è§£æ›´å¤š Rust é¡¹ç›®å®è·µï¼**

> æœ¬æ–‡é¦–å‘äº CSDNï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚

---

**æ ‡ç­¾**: `Rust` `CLI` `é‡å¤æ–‡ä»¶` `æ–‡ä»¶ç®¡ç†` `å¼€æºé¡¹ç›®`

